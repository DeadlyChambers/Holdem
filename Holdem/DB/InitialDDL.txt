CREATE TABLE Tables (
Id UNIQUEIDENTIFIER NOT NULL PRIMARY KEY, 
Name VARCHAR(50) NOT NULL, 
MinBet DECIMAL(19,2) NOT NULL, 
MaxBet DECIMAL(19,2) NULL, 
BuyIn DECIMAL(19,2) NOT NULL,
Active BIT NOT NULL)
GO

CREATE TABLE Players (
Id UNIQUEIDENTIFIER NOT NULL PRIMARY KEY, 
Name VARCHAR(50) NOT NULL, 
Cash DECIMAL(19,2) NOT NULL DEFAULT 0.00) 
GO

CREATE TABLE Rounds (
Id UNIQUEIDENTIFIER NOT NULL PRIMARY KEY, 
TableId UNIQUEIDENTIFIER NOT NULL ,
Cards NVARCHAR(500) NULL, 
Pot DECIMAL(19,2) NOT NULL DEFAULT 0.00, 
Active BIT NOT NULL DEFAULT 1,
Dealer TINYINT NOT NULL DEFAULT 1,
Started BIT NOT NULL DEFAULT 0,
Place TINYINT NOT NULL DEFAULT 0,
CurrentBet DECIMAL(19,2) NOT NULL DEFAULT 0.00)
GO

ALTER TABLE Rounds ADD CONSTRAINT fk_table_round FOREIGN KEY (TableId) REFERENCES Tables (Id)
GO
CREATE INDEX ix_rounds_tableId ON Rounds (TableId)
GO

CREATE TABLE PlayerHands(
PlayerId UNIQUEIDENTIFIER NOT NULL,
RoundId UNIQUEIDENTIFIER NOT NULL,
Position TINYINT NOT NULL DEFAULT 1,
Cards NVARCHAR(200) NULL,
TotalCash DECIMAL(19,2) NOT NULL,
Acting BIT NOT NULL,
Active BIT NOT NULL DEFAULT 1,
Won BIT NOT NULL DEFAULT 0,
CurrentBet DECIMAL(19,2) NOT NULL DEFAULT 0.00,
CashIn DECIMAL(19,2) NOT NULL DEFAULT 0.00,
AllIn BIT NOT NULL DEFAULT 0)
GO

ALTER TABLE PlayerHands ADD CONSTRAINT pk_player_round PRIMARY KEY (PlayerId, RoundId)
GO

ALTER TABLE PlayerHands ADD CONSTRAINT fk_player_hand FOREIGN KEY (PlayerId) REFERENCES Players (Id)
GO

ALTER TABLE PlayerHands Add CONSTRAINT fk_player_hands_round FOREIGN KEY (RoundId) REFERENCES Rounds (Id)
GO

--CREATE INDEX ix_player_hands ON PlayerHands (PlayerId)
--GO
--CREATE INDEX ix_player_hands_hand ON PlayerHands (HandId)
--GO
/*

DROP TABLE PlayerHands
DROP TABLE Rounds
DROP TABLE Players
DROP TABLE Tables
*/

select * from PlayerHands
select * from Rounds
select * from Tables
